# 问题记录

* [ ] 下午两点、晚上十点这样的词汇不应该返回具体的时间吗？怎么返回了第二天的时间
* [ ] “晚上8点到上午10点之间” 返回结果
* [ ] “2小时以前” 还不能识别



# 流程

1. 对不规范的表达做转换
2. 清理空白和语气助词以及大小写数字转化的预处理
3. 正则提取日期关键字
4. 获取基础时间
5. TimeUnit初始化：“待处理日期” [年，月，日，时，分，秒]
6. TimeUnit处理：获取当前标准时间
7. self.tp转换：将当前标准日期转换为列表格式（即[年，月，日，时，分，秒]这种方式）
8. 判断是为时间点/时间段
9. 获取时间表达式类型数组，时间点和时间段对应的数组不一样
10. 过滤timeUnit中无用的识别词
11. 返回格式：字典型，type用于标识返回数据的格式、timestamp标识返回的具体时间点


# 代码逻辑分析

TimeNormalizer类作为入口类

**parse->**
1. self._filter: 对不规范的表达转换
2. self.__preHandling
3. self.__timeEx



**_filter函数->**
1. StringPreHandler.numberTranslator(input_query): 将字符串中所有的用汉字表示的数字转化为用阿拉伯数字表示的数字
2. 去掉日期间的口语词汇：下个月 -> 下月
3. 将模糊时间/口语化描述时间具体化：中旬->15号（构建一个模糊/口语化时间映射词典）



# 实现逻辑

1. 去掉空格、简繁转换、汉字数字转阿拉伯数字
2. 将口语化的时间描述（包含语气助词）转换成统一格式（通过映射词典实现）
3. 节日、节气等转换为统一格式的时间
4. 时间点、时间段识别
5. 获取当前基准时间
6. 根据识别的时间点/时间段计算应该返回的合适时间（主要的逻辑代码，前面的为预处理模块）



# 接口

1. 具体日期
2. 时间段

```python
{
    "start_time": 
    "end_time": 
    "granularity": [年、半年、季度、月、上中下旬、半月、天、时、分]
    "fuzzy": [无、前、后、左右]
}
```

